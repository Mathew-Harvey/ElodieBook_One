<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake Stew - By Elodie Harvey</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(45deg, #8b5e3c, #6b4423);
            font-family: 'Comic Sans MS', cursive, sans-serif;
            padding: 20px;
            overflow-x: hidden;
        }

        .book-container {
            perspective: 2000px;
            transform-style: preserve-3d;
            width: min(60vw, calc(70vh / 1.4142));
            height: calc(min(60vw, calc(70vh / 1.4142)) * 1.4142);
            position: relative;
            margin: 0 auto;
            overflow: visible;
        }

        .book {
            position: absolute;
            transform-style: preserve-3d;
            width: 100%;
            height: 100%;
            user-select: none;
            transition: all 0.5s ease;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            transform-origin: center;
            left: 50%;
            top: 0;
            transform: translateX(-50%);
        }

        .book.opened {
            width: 100%;
            transform: translateX(-1%);
            /* Changed from 'none' to -25% to center the doubled width */
            box-shadow: 0 20px 30px rgba(0, 0, 0, 0.2),
                0 0 40px rgba(0, 0, 0, 0.1);
        }

        .page {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            right: 0;
            transform-origin: left center;
            transform-style: preserve-3d;
            transition: all 0.8s cubic-bezier(0.645, 0.045, 0.355, 1);
            cursor: default;
            pointer-events: auto;
            background: white;
            border-radius: 2px;
            box-shadow:
                0 4px 8px rgba(0, 0, 0, 0.1),
                5px 5px 15px rgba(0, 0, 0, 0.15);

            backface-visib .page.disabled {
                pointer-events: none;
            }
        }
            /* Enhance page turning visual */
            .page.turning {
                transition: transform 0.5s ease;
                box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            }

            .page-front,
            .page-back {
                position: absolute;
                width: 100%;
                height: 100%;
                padding: min(5vw, 40px);
                backface-visibility: hidden;
                background: white;
                border-radius: 2px;
                overflow: hidden;
            }

            .page-back {
                transform: rotateY(180deg);
            }

            .spine {
                position: absolute;
                left: -20px;
                /* Half spine width */
                width: 40px;
                height: 100%;
                background: linear-gradient(315deg, #00796b, #1976d2, #009688, #0288d1);                transform: rotateY(90deg) translateZ(-20px);
                transform-origin: right;
                z-index: 2;
                border-radius: 2px 0 0 2px;
                box-shadow: inset -2px 0 5px rgba(0, 0, 0, 0.1);
            }

            .cover-page {
                background: linear-gradient(315deg, #00796b, #1976d2, #009688, #0288d1);                color: white;
                border-radius: 2px;
            }

            /* Adjust page turning mechanics */
            .page.turned {
                transform: rotateY(-180deg);
            }

            .turn-area {
                position: absolute;
                width: 20%;
                height: 100%;
                top: 0;
                z-index: 10;
                cursor: pointer;
                opacity: 0;
                /* Hide by default */
                transition: opacity 0.3s ease;
            }

            .book.opened .turn-area {
                opacity: 1;
                /* Show when book is opened */
            }


            .turn-area-right {
                right: 0;
                background: linear-gradient(to right, transparent, rgba(0, 0, 0, 0.05));
            }

            .turn-area-left {
                left: 0;
                background: linear-gradient(to left, transparent, rgba(0, 0, 0, 0.05));
            }

            .turn-indicator {
                position: absolute;
                top: 50%;
                transform: translateY(-50%);
                width: 40px;
                height: 40px;
                opacity: 0;
                transition: opacity 0.3s;
                pointer-events: none;
            }

            .turn-area-right .turn-indicator {
                right: 20px;
                background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23000000' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='9 18 15 12 9 6'%3E%3C/polyline%3E%3C/svg%3E") no-repeat center;
            }

            .turn-area-left .turn-indicator {
                left: 20px;
                background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23000000' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='15 18 9 12 15 6'%3E%3C/polyline%3E%3C/svg%3E") no-repeat center;
            }

            .turn-area:hover .turn-indicator {
                opacity: 0.6;
            }


            .cover-title {
                font-size: min(8vw, 48px);
                margin: 20px 0;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
                text-align: center;
            }

            .cover-author {
                font-size: min(4vw, 24px);
                margin-top: 40px;
                font-style: italic;
                text-align: center;
            }

            .cover-illustrator {
                font-size: min(3vw, 18px);
                text-align: center;
            }

            .story-text {
                font-size: min(4vw, 24px);
                line-height: 1.6;
                color: #2d3748;
                margin: 20px 0;
            }

            img {
                width: 100%;
                height: min(50vw, 400px);
                object-fit: cover;
                border-radius: 10px;
                margin: 20px 0;
            }

            .page-number {
                position: absolute;
                bottom: 20px;
                right: 20px;
                font-size: min(2.5vw, 14px);
                color: #666;
            }

            .turned {
                transform: rotateY(-180deg);
            }

            @keyframes pulse {
                0% {
                    transform: translateX(0);
                }

                50% {
                    transform: translateX(10px);
                }

                100% {
                    transform: translateX(0);
                }
            }

            .initial-hint {
                animation: pulse 1.5s infinite;
            }

            /* Base accessibility styles - keep these outside media queries */
            .sr-only {
                position: absolute;
                width: 1px;
                height: 1px;
                padding: 0;
                margin: -1px;
                overflow: hidden;
                clip: rect(0, 0, 0, 0);
                border: 0;
            }

            .turn-area:focus {
                outline: 2px solid #4299e1;
                outline-offset: -2px;
            }

            .turn-area:focus:not(:focus-visible) {
                outline: none;
            }

            /* Tablets and smaller laptops */
            @media (max-width: 1024px) {
                .book-container {
                    width: min(70vw, calc(75vh / 1.4142));
                    height: calc(min(70vw, calc(75vh / 1.4142)) * 1.4142);
                }

                .story-text {
                    font-size: min(3vw, 20px);
                    line-height: 1.5;
                }

                .turn-area {
                    width: 25%;
                    /* Slightly larger touch target */
                }
            }

            /* Mobile devices */
            @media (max-width: 768px) {
                .book-container {
                    width: min(85vw, calc(80vh / 1.4142));
                    height: calc(min(85vw, calc(80vh / 1.4142)) * 1.4142);
                }

                .book {
                    left: 50%;
                    transform: translateX(-50%);
                }

                .book.opened {
                    transform: translateX(-50%);
                }

                .spine {
                    left: -15px;
                    width: 30px;
                }

                .page-front,
                .page-back {
                    padding: 15px;
                }

                .story-text {
                    font-size: 16px;
                    line-height: 1.4;
                }

                .turn-area {
                    width: 30%;
                }

                .cover-title {
                    font-size: min(6vw, 36px);
                }

                .cover-author {
                    font-size: min(4vw, 20px);
                }

                .cover-illustrator {
                    font-size: min(3vw, 16px);
                }
            }

            /* Fold phones and small devices */
            @media (max-width: 480px) {
                .book-container {
                    width: min(90vw, calc(85vh / 1.4142));
                    height: calc(min(90vw, calc(85vh / 1.4142)) * 1.4142);
                }

                .book.opened {
                    width: 200%;
                }

                .spine {
                    left: -10px;
                    width: 20px;
                }

                .page-front,
                .page-back {
                    padding: 12px;
                }

                .story-text {
                    font-size: 14px;
                    line-height: 1.3;
                }

                .turn-area {
                    width: 35%;
                    /* Even larger touch target for small screens */
                }

                .cover-title {
                    font-size: min(7vw, 32px);
                }

                .cover-author {
                    font-size: min(5vw, 18px);
                }

                .cover-illustrator {
                    font-size: min(4vw, 14px);
                }

                .page-number {
                    font-size: 12px;
                    bottom: 10px;
                    right: 10px;
                }
            }

            /* Ensure proper display in landscape orientation */
            @media (max-height: 480px) and (orientation: landscape) {
                .book-container {
                    width: min(50vw, calc(90vh / 1.4142));
                    height: calc(min(50vw, calc(90vh / 1.4142)) * 1.4142);
                }

                .page-front,
                .page-back {
                    padding: 10px;
                }

                .story-text {
                    font-size: 12px;
                    line-height: 1.2;
                    margin: 10px 0;
                }

                img {
                    height: min(30vw, 200px);
                    margin: 10px 0;
                }
            }
    </style>
</head>

<body>
    <div class="book-container" aria-label="Interactive storybook: Snake Stew">
        <div class="book">
            <div class="spine" aria-hidden="true"></div>
    
            <!-- Cover -->
            <div class="page" id="cover">
                <div class="page-front cover-page">
                    <h1 class="cover-title">Snake Stew</h1>
                    <img src="Images\Cover.jpg" alt="A magical forest scene with an owl cooking" />
                    <p class="cover-author">Written by Elodie Harvey</p>
                    <p class="cover-illustrator">Illustrated by Dali AI</p>
                </div>
                <div class="page-back">
                    <img src="Images/pageOne.jpg" alt="A clever owl in the forest" />
                    <p class="story-text">Many moons ago, there was a clever owl who lived in a deep, dark forest. One day, he caught many snakes and decided to make snake stew.</p>
                    <span class="page-number" aria-label="Page 1">1</span>
                </div>
            </div>
    
            <!-- Page 2-3 -->
            <div class="page">
                <div class="page-front">
                    <img src="Images/pageTwo.jpg" alt="A fish jumping from a puddle" />
                    <p class="story-text">First, a fish swam out of a puddle, leaping like it was being cast in a pan, and said, "The best thing to add to snake stew is shrimp!"</p>
                    <span class="page-number" aria-label="Page 2">2</span>
                </div>
                <div class="page-back">
                    <img src="Images/pageThree.jpg" alt="A vulture flying like a stingray" />
                    <p class="story-text">Next, a vulture flew out of his magnifying barrel, swooping like a stingray, and suggested, "Snake eggs are the best ingredient!"</p>
                    <span class="page-number" aria-label="Page 3">3</span>
                </div>
            </div>
    
            <!-- Page 4-5 -->
            <div class="page">
                <div class="page-front">
                    <img src="Images/pageFour.jpg" alt="An octopus in an ink barrel" />
                    <p class="story-text">After that, an octopus swam out of an ink barrel and said, "The best thing for snake stew is glowworms that glow in the dark!"</p>
                    <span class="page-number" aria-label="Page 4">4</span>
                </div>
                <div class="page-back">
                    <img src="Images/pageFive.jpg" alt="Animals gathering around a glowing pot" />
                    <p class="story-text">Finally, the clever owl thanked all his forest friends for their suggestions. He mixed together the snakes, shrimp, snake eggs, and glowworms in his biggest cooking pot.</p>
                    <span class="page-number" aria-label="Page 5">5</span>
                </div>
            </div>
    
            <!-- Final Pages -->
            <div class="page">
                <div class="page-front">
                    <img src="Images/pageSix.jpg" alt="A magical glowing forest" />
                    <p class="story-text">As the stew simmered, it began to glow with magical colors, lighting up the dark forest like a rainbow. All the animals gathered around to taste the magical snake stew, and from that day forward, it became the most famous recipe in the entire forest.</p>
                    <span class="page-number" aria-label="Page 6">6</span>
                </div>
                <div class="page-back">
                    <div style="text-align: center; margin-top: 300px;">
                        <h2>The End</h2>
                        <p class="story-text">Thank you for reading!</p>
                    </div>
                    <span class="page-number" aria-label="Page 7">7</span>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const book = document.querySelector('.book');
            const pages = document.querySelectorAll('.page');
            let currentPage = 0;
            let startX = 0;
            let isDragging = false;
            let isAnimating = false;
            let isBookOpened = false;

            // Add turn areas to all pages
            pages.forEach((page, index) => {
                const rightTurnArea = document.createElement('div');
                rightTurnArea.className = 'turn-area turn-area-right';
                rightTurnArea.setAttribute('role', 'button');
                rightTurnArea.setAttribute('tabindex', '0');
                rightTurnArea.setAttribute('aria-label', `Turn to page ${index * 2 + 2}`);

                const leftTurnArea = document.createElement('div');
                leftTurnArea.className = 'turn-area turn-area-left';
                leftTurnArea.setAttribute('role', 'button');
                leftTurnArea.setAttribute('tabindex', '0');
                leftTurnArea.setAttribute('aria-label', `Turn back to page ${index * 2}`);

                // Add turn indicators
                const rightIndicator = document.createElement('div');
                rightIndicator.className = 'turn-indicator';
                if (index === 0) rightIndicator.classList.add('initial-hint');
                rightTurnArea.appendChild(rightIndicator);

                const leftIndicator = document.createElement('div');
                leftIndicator.className = 'turn-indicator';
                leftTurnArea.appendChild(leftIndicator);

                page.appendChild(rightTurnArea);
                page.appendChild(leftTurnArea);
            });

            function initializeBook() {
                // Set initial state

                pages.forEach((page, index) => {
                    page.style.zIndex = pages.length - index;
                    if (index > 0) {
                        page.classList.add('disabled');
                    }
                });

                updatePageVisibility();
            }
            function turnPage(index, direction) {
                if (isAnimating) return;

                isAnimating = true;
                const page = pages[index];
                page.classList.add('turning');

                if (direction === 'forward') {
                    page.classList.add('turned');
                    currentPage = index + 1;
                } else if (direction === 'backward') {
                    page.classList.remove('turned');
                    currentPage = index;
                }

                setTimeout(() => {
                    page.classList.remove('turning');
                    isAnimating = false;
                    updatePageVisibility();
                }, 500);
            }

            function updatePageVisibility() {
                // Ensure book is marked as opened when pages are turned
                if (currentPage > 0 && !isBookOpened) {
                    openBook();
                }
                pages.forEach((page, index) => {
                    // Reset transforms and classes
                    page.style.transform = page.classList.contains('turned') ? 'rotateY(-180deg)' : '';
                    page.classList.remove('disabled');

                    // Calculate z-index
                    const baseZIndex = pages.length * 2;
                    let zIndex;

                    if (index < currentPage) {
                        zIndex = index;
                    } else if (index === currentPage) {
                        zIndex = baseZIndex;
                    } else {
                        zIndex = baseZIndex - (index - currentPage);
                    }

                    page.style.zIndex = zIndex;

                    // Update turn areas
                    const rightTurnArea = page.querySelector('.turn-area-right');
                    const leftTurnArea = page.querySelector('.turn-area-left');

                    if (rightTurnArea) {
                        const canTurnForward = index === currentPage && currentPage < pages.length - 1;
                        rightTurnArea.style.pointerEvents = canTurnForward ? 'auto' : 'none';
                        rightTurnArea.style.opacity = canTurnForward ? '1' : '0';
                    }

                    if (leftTurnArea) {
                        const canTurnBackward = index === currentPage - 1;
                        leftTurnArea.style.pointerEvents = canTurnBackward ? 'auto' : 'none';
                        leftTurnArea.style.opacity = canTurnBackward ? '1' : '0';
                    }

                    // Enable/disable pages based on current page
                    if (index < currentPage - 1 || index > currentPage + 1) {
                        page.classList.add('disabled');
                    }
                });
            }
            // Replace the click event handler with this:
            function openBook() {
                if (!isBookOpened) {
                    isBookOpened = true;
                    book.classList.add('opened');
                    updatePageVisibility();
                }
            }

            // Click event for opening the book - more specific targeting
            book.addEventListener('click', (e) => {
                // Only trigger if clicking on the cover page when book is closed
                if (!isBookOpened &&
                    e.target.closest('#cover') &&
                    !e.target.classList.contains('turn-area')) {
                    openBook();
                }
            });

            // Handle touch events
            book.addEventListener('touchstart', (e) => {
                if (isAnimating) return;
                startX = e.touches[0].clientX;
                isDragging = true;
            }, { passive: true });

            book.addEventListener('touchmove', (e) => {
                if (!isDragging || isAnimating) return;
                const currentX = e.touches[0].clientX;
                const diff = currentX - startX;

                // Add visual feedback during drag
                const page = pages[currentPage];
                if (page) {
                    if (diff < 0) {
                        // Dragging forward
                        const rotation = Math.max(-180, diff);
                        page.style.transform = `rotateY(${rotation}deg)`;
                    } else if (currentPage > 0) {
                        // Dragging backward
                        const prevPage = pages[currentPage - 1];
                        const rotation = Math.min(0, -180 + (diff / 2));
                        prevPage.style.transform = `rotateY(${rotation}deg)`;
                    }
                }
            }, { passive: true });

            book.addEventListener('touchend', (e) => {
                if (!isDragging) return;

                const currentX = e.changedTouches[0].clientX;
                const diff = currentX - startX;
                const threshold = 50;

                if (Math.abs(diff) > threshold) {
                    if (diff > 0 && currentPage > 0) {
                        // Swipe right - go back
                        turnPage(currentPage - 1, 'backward');
                    } else if (diff < 0 && currentPage < pages.length - 1) {
                        // Swipe left - go forward
                        turnPage(currentPage, 'forward');
                    }
                } else {
                    // Reset page position if threshold not met
                    updatePageVisibility();
                }

                isDragging = false;
            });


            function announcePageTurn(pageNumber) {
                let liveRegion = document.getElementById('page-turn-announcement');
                if (!liveRegion) {
                    liveRegion = document.createElement('div');
                    liveRegion.id = 'page-turn-announcement';
                    liveRegion.className = 'sr-only';
                    liveRegion.setAttribute('aria-live', 'polite');
                    document.body.appendChild(liveRegion);
                }

                const pageNumbers = pageNumber * 2 === 0 ? 'Cover' : `Pages ${pageNumber * 2}-${pageNumber * 2 + 1}`;
                liveRegion.textContent = `Now viewing ${pageNumbers}`;
            }

            // Click and keyboard handlers
            document.querySelectorAll('.turn-area-right').forEach((area, index) => {
                area.addEventListener('click', () => turnPage(index, 'forward'));
                area.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        turnPage(index, 'forward');
                    }
                });
            });

            document.querySelectorAll('.turn-area-left').forEach((area, index) => {
                area.addEventListener('click', () => turnPage(index, 'backward'));
                area.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        turnPage(index, 'backward');
                    }
                });
            });

            // Handle keyboard navigation through pages
            document.addEventListener('keydown', (e) => {
                if (isAnimating) return;

                switch (e.key) {
                    case 'ArrowRight':
                    case 'PageDown':
                        if (currentPage < pages.length - 1) {
                            e.preventDefault();
                            turnPage(currentPage, 'forward');
                        }
                        break;
                    case 'ArrowLeft':
                    case 'PageUp':
                        if (currentPage > 0) {
                            e.preventDefault();
                            turnPage(currentPage - 1, 'backward');
                        }
                        break;
                    case 'Home':
                        e.preventDefault();
                        while (currentPage > 0) {
                            turnPage(currentPage - 1, 'backward');
                        }
                        break;
                    case 'End':
                        e.preventDefault();
                        while (currentPage < pages.length - 1) {
                            turnPage(currentPage, 'forward');
                        }
                        break;
                }
            });

            // Initialize the book
            initializeBook();
        });
    </script>

</body>

</html>